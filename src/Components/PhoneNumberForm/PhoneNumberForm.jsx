"use client";

import React, { useState } from "react";
import { toast } from "react-toastify";
import SubmitButton from "@/Components/SubmitButton/SubmitButton";
import ModalWrapper from "@/Components/ModalWrapper/ModalWrapper";

export default function PhoneNumberForm({ onSuccess }) {
  const [phoneNumber, setPhoneNumber] = useState("");
  const [loading, setLoading] = useState(false);
  const [showModal, setShowModal] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (loading) return;
    setLoading(true);

    try {
      const res = await fetch("/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phoneNumber }),
      });

      const data = await res.json();
      if (!data.isSuccess) {
        toast.error(data.message || "ارسال ناموفق بود");
      } else {
        onSuccess(phoneNumber);
        toast.success("کد تأیید ارسال شد");
      }
    } catch {
      toast.error("خطای شبکه");
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <h1 className="text-center w-full pb-5 border-b-2 border-gray-300">
        ورود به حساب کاربری
      </h1>

      <form
        onSubmit={handleSubmit}
        className="w-full absolute top-[40%] right-[50%] translate-x-[50%]"
      >
        <div className="flex flex-col gap-y-4 justify-center items-center">
          <label htmlFor="number">شماره همراه خود را وارد کنید</label>
          <input
            id="number"
            name="number"
            type="tel"
            className="mt-1 block w-[80%] max-w-[450px] px-3 py-2 border-2 border-[#DBDBDB] rounded-[30px] shadow-sm focus:outline-none text-center"
            value={phoneNumber}
            onChange={(e) => {
              const val = e.target.value.replace(/\D/g, "");
              setPhoneNumber(val.slice(0, 11));
            }}
          />
          <SubmitButton
            title="ارسال"
            disabled={phoneNumber.length < 11 || loading}
          />
        </div>

        <div className="w-full text-center mt-6 text-gray-400 text-sm">
          <p>
            ثبت نام در تکسایز به منزله‌ی
            <button
              type="button"
              onClick={() => setShowModal(true)}
              className="text-green-500 font-bold"
            >
              پذیرش قوانین
            </button>
            آن است
          </p>
        </div>
      </form>

      <ModalWrapper isOpen={showModal} onClose={() => setShowModal(false)}>
        <h2 className="text-lg font-bold mb-4">قوانین تکسایز</h2>
        <div className="max-h-[70vh] overflow-y-auto pr-2">
          <p className="text-sm text-justify text-gray-700 leading-loose">
            به وب‌سایت تک سایز خوش آمدید. شما ضمن استفاده از تک سایز (شامل سایت
            [www.taksizee.com،](http://www.taksizee.com،) و اپلیکیشن، خدمات و
            ابزارهای مرتبط با آن)، موافقت خود را با شرایط و ضوابط تعیین شده توسط
            این شرکت، به شرح زیر اعلام کرده‌اید. در زمان ثبت آگهی یا استفاده از
            وب‌سایت و خدمات آن با قوانین و با آگاهی نسبت به عرف اسلامی به عهده
            شما خواهد بود. در ضمن صحت و سقم اطلاعات آگهی‌ها بر عهده آگهی‌دهنده
            می‌باشد. برای بررسی حقوقی کامل محتوای آگهی‌ها، شما می‌بایست با شرایط
            اعلام شده در زیر آشنا گردید. آگهی‌های شما ممکن است بر اساس جستجو
            کلیدی یا دسته‌بندی برای چند ساعت قابل جستجو نباشد (بعضی مواقع تا ۲۴
            ساعت)، بنابراین تک سایز نمی‌تواند مدت زمان دقیق فهرست‌بندی آگهی را
            تعیین و تضمین کند. مسئولیت هرگونه تخلف از قوانین جمهوری اسلامی
            ایران، در هرگونه نقش و ایراد در کالای فروخته شده بر عهده فروشنده
            می‌باشد و تک سایز در این مورد مسئولیتی ندارد. این سایت صرفاً محلی
            برای درج آگهی‌ها است. مسئولیت وجود هرگونه نقص یا خود کاربران است.
            اگر لینک‌های تبلیغاتی، خدمات و کالاهای ارائه شده در این لینک‌ها
            باشد، مسئولیتی متوجه تک سایز نمی‌باشد. سایت تک سایز نمی‌تواند مسئول
            هر نوع عملکرد ضعیف سخت‌افزار، خدمات یا ابزارهای ما، نسبت به خدمات
            است در اثر فاکتورهای سیستمی که خارج از کنترل ما هستند، دچار اختلال
            شود. بنابراین، تا جایی که قانون مجاز دانسته، ما کلیه ضمانت‌های صریح
            و ضمنی را سلب می‌کنیم. ممکن است در هر زمان، این توافق‌نامه تغییر کند
            یا اصلاح شود که موارد اصلاح شده در تک سایز اعلام خواهد شد. در صورت
            بروز اختلاف بین مالک شماره همراه و کاربر در مورد این سرویس، مالک
            شماره همراه، تماماً و کاملاً مسئول خواهد بود. تک سایز نسبت به صحت
            واقعی محصول مسئولیتی ندارد. اگر فروشنده متعهد شود و توضیحات درج‌شده
            در شرایط و استانداردهای یک آگهی، مطابق باشد، امتیاز تعلق خواهد گرفت
            که خریداران با مشاهده آن می‌توانند با اطمینان از واقعی بودن آن
            خریداری و پرداخت نمایند. مسئولیت و عواقب استفاده از حساب کاربری به
            عهده شخصی است که اطلاعات حساب را وارد کرده است. شما متعهد هستید تمام
            اطلاعات و مدارک موردنیاز را به صورت صحیح تا مقفود شدن اطلاعات کاربری
            در اسرع وقت به تک سایز اطلاع دهید. درج و ذخیره‌سازی و بروزرسانی کلیه
            اطلاعات نظیر نام و نام خانوادگی، تلفن ثابت، تلفن همراه، ایمیل، نشانی
            پستی و تلفن محل سکونت و کسب‌وکار، بر عهده کاربران است و تک سایز
            هیچگونه مسئولیتی در قبال آن ندارد. در صورت بروز تخلف از قوانین
            جمهوری اسلامی ایران یا شکایات اجتماعی یا پرسش‌ها و سایر کانال‌های
            ارتباطی، تک سایز مطابق با قوانین عمل خواهد کرد. در صورت درخواست رسمی
            مراجع ذی‌ربط، تک سایز اطلاعات لازم را در اختیار آن‌ها قرار خواهد داد
            و تابع قوانین جمهوری اسلامی عمل خواهد کرد. تک سایز نسبت به حفظ و
            نگهداری حقوق مالکیت فکری خود متعهد می‌باشد. نمی‌توانید حق سایرین را
            نسبت به این امر در سایت نقض نمایید. همچنین تک سایز، در صورت بروز نقص
            حقوق مالکیت، معنوی و فکری با قوانین تشخیص داده شده، اقدام قانونی
            خواهد کرد. در صورت حذف محتوا توسط کاربران، تک سایز مسئولیتی بابت حذف
            و از بین رفتن محتوا نخواهد داشت در صورت گرفتن، کاربر موظف است داغ و
            موارد ساختن جنگ سایز، از این بابت مسئول است که کاربر در این موارد از
            تک سایز، (شامل کلیه کارمندان و اشخاص مرتبط، نمایندگی‌ها و شرکت‌های
            مادر، زیرمجموعه‌ها، شرکای تجاری و فروشگاه‌های دیگر و مجموعه‌های
            مختلف)، شکایتی نداشته باشد. تک سایز در صورت اعمال تعامل نادرست،
            مستحق پیگرد قانونی می‌باشد. تک سایز هیچ‌گونه مسئولیتی در این باره
            ندارد و مسئولیت هر اثر ممکن است در اثر تعاملات روی دهد به خود
            کاربران بازمی‌گردد. تک سایز، فروشنده نیست. فلذا کلیه مسائل مربوط به
            آن، از قبیل تولید و بارگذاری محتوا یا اطلاعات محصولات، قیمت‌گذاری و
            تنظیم هزینه ارسال آن‌ها به عهده فروشنده خواهد بود. بنابراین مسئولیت
            هر نوع ضرر و زیان (اعم از خریداران و فروشندگان)، پیش‌آمده پس از
            فعالیت پس از بازار و ظاهر بر پلتفرم و خدمات آن خواهد بود. تک سایز حق
            دارد هرگونه آگهی نامناسب، ناقض قوانین، کلاهبردارانه یا محتوای ممنوعه
            را بدون اطلاع قبلی حذف نماید. (اعم از تبلیغ، فروش، اجاره، خرید و
            فروش ارز، خدمات بانکی، کالاهای قاچاق و ممنوعه، محتوای غیر اخلاقی،
            فعالیت‌های غیرقانونی، فروش اسلحه و مواد مخدر، فیشینگ، اسپم، شرط‌بندی
            و موارد مشابه). تبلیغ در عنوان آگهی با مواردی مانند: رایگان، قیمت
            مناسب، ارزان، زیر قیمت، استثنائی، حراج و موارد مشابه، ممنوع می‌باشد.
            استفاده از زبان انگلیسی برای نوشتن کلمات غیرفارسی و برندها و یا ثبت
            آگهی به زبان انگلیسی مانعی ندارد. تک سایز موظف نیست اطلاعات تماس را
            در آگهی منتشر نماید. در صورت وجود شکایت، باید شماره تماس ثبت شده در
            آگهی پاسخگو باشد. در صورت تکرار تخلف، حساب کاربری شما مسدود خواهد
            شد. محتوای آگهی نباید بیشتر از ۷۲ ساعت تکراری ثبت شود. درج آگهی
            تکراری باعث مسدود شدن حساب کاربری خواهد شد. تک سایز هیچ مسئولیتی در
            قبال قراردادها و معاملات ندارد. تک سایز حق دارد با شماره همراه یا
            نشانی پست الکترونیکی دیگران پیگیر و تماس حاصل کند.
          </p>
        </div>
      </ModalWrapper>
    </>
  );
}
